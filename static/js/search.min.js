
(function(){var Haps;Haps={init:function(){var searchButton,searchInput,toggleButton;searchInput=$("#search");searchButton=$("#search-button");Haps.lastQuery=null;Haps.searchDefault=searchInput.val();searchInput.addClass("tip");searchInput.focus(Haps.searchFocus);searchInput.blur(Haps.searchBlur);searchButton.click(Haps.searchClick);toggleButton=$("#search-toggle");return toggleButton.click(Haps.searchToggle);},searchClick:function(event){var query,searchInput;searchInput=$("#search");query=Haps.strip(searchInput.val());if(query===""||query===Haps.searchDefault||query===Haps.lastQuery){return;}
return Haps.search(query);},search:function(query){$("#place").text("");Haps.postFeed(query,"/feeds/flickr",'flickr',Haps.flickrResponse,Haps.flickrError);Haps.postFeed(query,"/feeds/twitter",'twitter',Haps.twitterResponse,Haps.twitterError);Haps.postFeed(query,"/feeds/lastfm","lastfm",Haps.lastfmResponse,Haps.lastfmError);return Haps.postFeed(query,"/feeds/yelp","yelp",Haps.yelpResponse,Haps.yelpError);},postFeed:function(query,url,listId,callback,errorCallback){var data,params;Haps.loadList(listId);data={_xsrf:Haps.getXsrf(),location:query};params={url:url,success:callback,error:errorCallback,dataType:"json",data:data,cache:false,type:"POST"};return $.ajax(params);},clearList:function(elId){var el;el=$('#'+elId);return el.find('li').not(".column-title").remove();},loadList:function(elId){var el;Haps.clearList(elId);el=$('#'+elId);return el.append("<li class='loading'>Loading...</li>");},noResults:function(elId){var el;Haps.clearList(elId);el=$('#'+elId);return el.append("<li class='no-results'>(no results)</li>");},updatePlace:function(place){var placeTitle;placeTitle=$("#place");if(Haps.strip(placeTitle.text())===""){return placeTitle.text(place);}},yelpError:function(response){return Haps.noResults('yelp');},yelpResponse:function(response){var result,results,yelp,_i,_len,_results;yelp=$("#yelp");results=response.entries;if(!results||results.length===0){return Haps.noResults('yelp');}
Haps.clearList('yelp');_results=[];for(_i=0,_len=results.length;_i<_len;_i++){result=results[_i];_results.push(yelp.append("<li><img src='"+result.image+"'/>"+result.name+"</li>"));}
return _results;},lastfmError:function(response){return Haps.noResults('lastfm');},lastfmResponse:function(response){var lastfm,result,results,_i,_len,_results;lastfm=$("#lastfm");results=response.entries;if(!results||results.length===0){return Haps.noResults('lastfm');}
Haps.clearList("lastfm");_results=[];for(_i=0,_len=results.length;_i<_len;_i++){result=results[_i];_results.push(lastfm.append("<li><img src='"+result.image+"'/>"+result.title+"</li>"));}
return _results;},flickrError:function(response){return Haps.noResults('flickr');},flickrResponse:function(response){var flickr,result,results,_i,_len;flickr=$("#flickr");results=response.entries;if(!results||results.length===0){return Haps.noResults('flickr');}
Haps.clearList('flickr');for(_i=0,_len=results.length;_i<_len;_i++){result=results[_i];flickr.append("<li><img src='"+result.images.square+"'/></li>");}
if(response.place){return Haps.updatePlace(response.place);}},twitterResponse:function(response){var result,results,twitter,_i,_len;twitter=$("#twitter");results=response.entries;if(!results||results.length===0){return Haps.noResults('twitter');}
Haps.clearList('twitter');for(_i=0,_len=results.length;_i<_len;_i++){result=results[_i];twitter.append("<li><img src='"+result.image+"'/>"+result.text+"</li>");}
if(response.place){return Haps.updatePlace(response.place);}},getXsrf:function(){return $('input[name="_xsrf"]').val();},searchFocus:function(event){var searchInput;searchInput=$(event.target);if(searchInput.hasClass("tip")){searchInput.val('');return searchInput.removeClass("tip");}},searchBlur:function(event){var searchInput,searchVal;searchInput=$(event.target);searchVal=Haps.strip(searchInput.val());if(searchVal===Haps.searchDefault||searchVal===""){searchInput.val(Haps.searchDefault);return searchInput.addClass("tip");}},searchToggle:function(event){var searchContainer,toggleButton;toggleButton=$('#search-toggle');searchContainer=$(".search-container");if(toggleButton.hasClass("hide")){searchContainer.slideUp();toggleButton.text("Show Search");return toggleButton.removeClass("hide");}else{searchContainer.slideDown();toggleButton.text("Hide Search");return toggleButton.addClass("hide");}},scroll:function(event){var docHeight,footer,height;docHeight=$(document).height();height=$(event.target).height();if(docHeight>height){height=docHeight;}
footer=$('.footer');return $('.footer').css('top',height+'px');},strip:function(text){return text.replace(/^\s+|\s+$/i,"");}};$(Haps.init);}).call(this);